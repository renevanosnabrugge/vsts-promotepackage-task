{
  "id": "7ca5869f-a901-4012-a50d-d0f9d436ffec",
  "name": "rvo-vsts-promotepackage-task",
  "friendlyName": "#{PrivatePublicExtension}#Promote package to Release View",
  "description": "Promotes a package to a Release View in VSTS Package Management",
  "helpMarkDown": "Version: #{PrivatePublicExtension}##{Build.BuildNumber}#. [More Information](https://github.com/renevanosnabrugge/vsts-promotepackage-task/wiki)",
  "category": "Package",
  "author": "Rene van Osnabrugge",
  "version": {
    "Major": 0,
    "Minor": 0,
    "Patch": 0
  },
  "visibility": [
    "Build",
    "Release"
  ],
  "minimumAgentVersion": "1.83.0",
  "inputs": [
    {
      "name": "feed",
      "type": "pickList",
      "label": "Use packages from this VSTS feed",
      "defaultValue": "",
      "helpMarkDown": "Include the selected feed in the generated NuGet.config.",
      "required": "true",
      "properties": {
        "EditableOptions": "true"
      }
    },
    {
      "name": "inputType",
      "type": "radio",
      "label": "Package input type",
      "defaultValue": "nameVersion",
      "helpMarkDown": "Preferred input type. Either specify the name and version explicitly, or parse one or multiple names and versions from package files. The conventions used are the same as the defaults from standard packaging tools (NuGet pack, dotnet pack, npm pack, etc).",
      "required": "true",
      "options": {
        "nameVersion": "Specify name and version",
        "packageFiles": "Parse name(s) and version(s) from package files"
      }
    },
    {
      "name": "packageIds",
      "aliases": [
        "definition"
      ],
      "type": "pickList",
      "label": "Package",
      "defaultValue": "",
      "helpMarkDown": "Select the package that you want to promote. Multiple packages may be supplied separated with a semicolon. Note you may use either the name of the package or its GUID.",
      "required": "true",
      "properties": {
        "EditableOptions": "true"
      },
      "visibleRule": "inputType = nameVersion"
    },
    {
      "name": "version",
      "type": "pickList",
      "label": "Package Version",
      "defaultValue": "",
      "helpMarkDown": "Select the version you want to promote or enter a variable",
      "required": "true",
      "properties": {
        "EditableOptions": "true"
      },
      "visibleRule": "inputType = nameVersion"
    },
    {
      "name": "packagesDirectory",
      "type": "filePath",
      "label": "Package source folder",
      "defaultValue": "$(System.DefaultWorkingDirectory)",
      "helpMarkDown": "The source folder that the copy pattern(s) will be run from.",
      "required": "true",
      "visibleRule": "inputType = packageFiles"
    },
    {
      "name": "packagesPatternParse",
      "type": "multiLine",
      "label": "Package contents",
      "defaultValue": "**/*.nupkg\n!**/*.symbols.nupkg\n**/*.tgz",
      "helpMarkDown": "The glob pattern to match or path to nupkg/tgz files to be parsed for package ID and version. Multiple patterns can be separated by a semicolon or be placed on separate lines.",
      "required": "true",
      "properties": {
        "resizable": "true",
        "rows": "10",
        "maxLength": "5000"
      },
      "visibleRule": "inputType = packageFiles"
    },
    {
      "name": "releaseView",
      "type": "pickList",
      "label": "Release Views",
      "defaultValue": "",
      "helpMarkDown": "Select the view to which to promote the package",
      "required": "true",
      "properties": {
        "EditableOptions": "true"
      }
    }
  ],
  "dataSourceBindings": [
    {
      "target": "feed",
      "endpointId": "tfs:feed",
      "endpointUrl": "{{endpoint.url}}/_apis/packaging/feeds",
      "resultSelector": "jsonpath:$.value[*]",
      "resultTemplate": "{ \"Value\" : \"{{{id}}}\", \"DisplayValue\" : \"{{{name}}}\" }"
    },
    {
      "target": "definition",
      "endpointId": "tfs:feed",
      "parameters": {
        "feed": "$(feed)"
      },
      "endpointUrl": "{{endpoint.url}}/_apis/Packaging/Feeds/{{{feed}}}/Packages?includeUrls=false",
      "resultSelector": "jsonpath:$.value[*]",
      "resultTemplate": "{ \"Value\" : \"{{{id}}}\", \"DisplayValue\" : \"{{{name}}}\" }"
    },
    {
      "target": "version",
      "endpointId": "tfs:feed",
      "parameters": {
        "feed": "$(feed)",
        "definition": "$(definition)"
      },
      "endpointUrl": "{{endpoint.url}}/_apis/Packaging/Feeds/{{{feed}}}/Packages/{{{definition}}}/Versions?includeUrls=false",
      "resultSelector": "jsonpath:$.value[*]",
      "resultTemplate": "{ \"Value\" : \"{{{version}}}\", \"DisplayValue\" : \"{{{version}}}\" }"
    },
    {
      "target": "releaseView",
      "endpointId": "tfs:feed",
      "parameters": {
        "feed": "$(feed)"
      },
      "endpointUrl": "{{endpoint.url}}/_apis/Packaging/Feeds/{{{feed}}}/views",
      "resultSelector": "jsonpath:$.value[*]",
      "resultTemplate": "{ \"Value\" : \"{{{id}}}\", \"DisplayValue\" : \"{{{name}}}\" }"
    }
  ],
  "instanceNameFormat": "Promote package to Release View",
  "execution": {
    "PowerShell3": {
      "target": "$(currentDirectory)\\vsts-promotepackage-task.ps1",
      "argumentFormat": ""
    }
  }
}
